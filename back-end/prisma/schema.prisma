generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  passwordHash String
  name         String?
  role         UserRole      @default(USER)
  subscription Subscription?
  usage        Usage?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  projects     Project[]
}

model Subscription {
  id        String    @id @default(cuid())
  user      User      @relation(fields: [userId], references: [id])
  userId    String    @unique
  plan      PlanType
  startedAt DateTime  @default(now())
  expiresAt DateTime?
  active    Boolean   @default(true)
}

model Usage {
  id            String   @id @default(cuid())
  user          User     @relation(fields: [userId], references: [id])
  userId        String   @unique
  requestsCount Int      @default(0)
  projectsCount Int      @default(0)
  lastReset     DateTime @default(now())
  year          Int
  month         Int

  @@unique([userId, year, month])
}

model Project {
  id     String @id @default(cuid())
  name   String
  user   User   @relation(fields: [userId], references: [id])
  userId String
}

enum PlanType {
  BASIC
  PRO
  ENTERPRISE
}

enum UserRole {
  USER
  ADMIN
}
